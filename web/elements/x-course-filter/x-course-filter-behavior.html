<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="x-course-filter-parameter-behavior.html">

<script>
  var App = App || {};
  App.CourseFilterBehaviorImpl = {

    /**
     * Fired when any filter parameter changes.
     *
     * @event changed
     */

    properties: {

      /**
       * Indicates that all filter parameters are cleared.
       */
      cleared: {
        type: Boolean,
        readOnly: true,
        value: true,
        notify: true
      }
    },

    observers: [
      "_changed(query, semester, allowedTypes.*, allowedGrades.*, requiredTags.*, forbiddenTags.*)",
      "_changed(query)"
    ],

    /**
     * Clears all parameters.
     */
    clear: function () {
      if (this.cleared) return;
      this.query = "";
      this.semester = null;
      this.allowedTypes = [];
      this.allowedGrades = [];
      this.requiredTags = [];
      this.forbiddenTags = [];
    },

    _changed: function () {
      this._setCleared(!this._isNotCleared());
      this.fire("change");
    },

    _isNotCleared: function () {
      return !!this.query && this.query.length > 0 ||
        !!this.semester ||
        this._isNonEmptyArray(this.allowedTypes) ||
        this._isNonEmptyArray(this.allowedGrades) ||
        this._isNonEmptyArray(this.requiredTags) ||
        this._isNonEmptyArray(this.forbiddenTags);
    },

    _isNonEmptyArray: function (object) {
      return (object instanceof Array) && object.length > 0;
    }
  };

  App.CourseFilterBehavior = [
    App.CourseFilterBehaviorImpl,
    App.CourseFilterParameterBehavior
  ];
</script>
