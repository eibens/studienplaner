<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-ripple/paper-ripple.html">
<link rel="import" href="../bower_components/paper-styles/paper-styles.html">
<link rel="import" href="data-model/data-model.html">
<link rel="import" href="x-grade-icon.html">

<dom-module id="x-course-attendances">
  <style>
    :host {
      @apply(--layout-vertical);
      @apply(--layout-center);
      width: 100%;
    }
    paper-button {
      margin: 8px 0;
      color: var(--default-primary-color);
    }
    .row {
      @apply(--layout);
      @apply(--layout-center);
      @apply(--layout-justified);
      @apply(--layout-self-stretch);
      position: relative;
      padding: 8px;
      transition: background 0.2s;
      cursor: pointer;
      border-radius: 3px;
      background: #eee;
      margin-bottom: 2px;
    }
    .semester {
      font-size: 14px;
    }
  </style>

  <template>
    <template
      id="list"
      is="dom-repeat"
      items="{{attendances}}"
      filter="_filter"
      sort="_sort"
      observe="time grade">
      <div
        class="row"
        on-tap="_handleSelect">
        <paper-ripple></paper-ripple>
        <div class="semester">{{_formatSemester(item.semester)}}</div>
        <x-grade-icon
          size="3"
          grade="[[item.grade]]">
        </x-grade-icon>
      </div>
    </template>
    <paper-button
      on-tap="_handleAdd">
      + Note hinzuf&uuml;gen
    </paper-button>
  </template>

  <script>
    Polymer({
      is: "x-course-attendances",

      properties: {
        attendances: {
          type: Array,
          value: []
        },
        course: {
          type: Object,
          value: null
        }
      },

      observers: [
        "_render(course)"
      ],

      _render: function () {
        this.$.list.render();
      },
      _filter: function (item) {
        return item.course === this.course;
      },
      _sort: function (a, b) {
        var semesterDiff = -Semester.compare(a.semester, b.semester);
        if (semesterDiff != 0) {
          return semesterDiff;
        }
        return Grade.compare(a.grade, b.grade);
      },

      _formatSemester: function (semester) {
        return semester.year + " " + (semester.isWinter ? "Winter" : "Sommer");
      },

      _handleAdd: function () {
        this.fire("add-attendance", {
          course: this.course,
          semester: Semester.current(),
          grade: null
        });
      },

      _handleSelect: function (event) {
        this.fire("select-attendance", { data: event.model.item });
      }
    });
  </script>
</dom-module>
