<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../data-model/data-model.html">
<link rel="import" href="x-course-type-filter.html">
<link rel="import" href="x-grade-filter.html">
<link rel="import" href="x-tag-filter.html">

<dom-module id="x-organizer">
  <style>
    :host {
      @apply(--layout-vertical);
      -webkit-user-select: none;
      user-select: none;
      width: 240px;
      color: rgb(97, 97, 97);
    }
    section {
      border-top: 1px solid rgba(0, 0, 0, 0.1);
      margin-bottom: 8px;
    }
    section:first-of-type {
      border: none;
    }
    h1 {
      font-weight: normal;
      font-size: 14px;
      margin: 16px 16px 8px 16px;
    }
    x-course-type-filter {
      padding-left: 16px;
    }
    x-grade-filter {
      padding-left: 16px;
    }
    x-tag-filter {
      font-size: 14px;
    }
  </style>

  <template>
    <section>
      <h1>Bewertungen</h1>
      <x-grade-filter
        selected="{{filter.grades.allowed}}">
      </x-grade-filter>
    </section>
    <section>
      <h1>Kurstypen</h1>
      <x-course-type-filter
        items="[[_types]]"
        selected="{{filter.types.allowed}}">
      </x-course-type-filter>
    </section>
    <section>
      <h1>Kategorien</h1>
      <x-tag-filter
        items="[[_tags]]"
        required="{{filter.tags.required}}"
        forbidden="{{filter.tags.forbidden}}">
      </x-tag-filter>
    </section>
  </template>

  <script>
    Polymer({
      is: "x-organizer",

      properties: {

        courses: {
          type: Array,
          value: []
        },

        filter: {
          type: Object,
          value: new Filter(),
          notify: true
        },

        _types: {
          type: Array,
          computed: "_computeTypes(courses.*)"
        },

        _tags: {
          type: Array,
          computed: "_computeTags(courses.*)"
        }
      },

      _computeTypes: function (courseChange) {
        var courses = courseChange.base;
        if (!courses) return [];
        var types = [ null ];
        courses.forEach(function (course) {
          if (types.indexOf(course.type) < 0) {
            types.push(course.type);
          }
        });
        return types;
      },

      _computeTags: function (courseChange) {
        var courses = courseChange.base;
        if (!courses) return [];
        var tags = [ ];
        courses.forEach(function (course) {
          course.tags.forEach(function (tag) {
            if (tags.indexOf(tag) < 0) {
              tags.push(tag);
            }
          });
        });
        return tags;
      }
    });
  </script>
</dom-module>
