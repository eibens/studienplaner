<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icons/editor-icons.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../data-model/data-model.html">
<link rel="import" href="x-course-type-filter.html">
<link rel="import" href="x-grade-filter.html">
<link rel="import" href="x-organizer-item.html">
<link rel="import" href="x-tag-filter.html">

<dom-module id="x-organizer">
  <style>
    :host {
      @apply(--layout-vertical);
      -webkit-user-select: none;
      user-select: none;
      width: 240px;
      overflow: hidden;
      padding: 0 8px;
      background: #272822;
      color: white;
      font-size: 14px;
      font-weight: 100;
    }
    :host(:hover) {
      overflow-y: scroll;
    }
    :host(::-webkit-scrollbar-thumb) {
      background: rgba(255, 255, 255, 0.1);
    }
    section {
      @apply(--layout-vertical);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      padding: 8px 0;
    }
    section:first-of-type {
      border: none;
    }
    h1 {
      font-weight: 100;
      font-size: 12px;
      margin: 8px 16px 8px 16px;
      opacity: 0.5;
    }
    input {
      display: block;
      border: none;
      outline: none;
      box-sizing: border-box;
      padding: 8px;
      border-radius: 3px;
      background: rgba(0, 0, 0, 0.1);
      margin: 12px 8px;
      color: white;
      transition: background 0.2s;
    }
    x-organizer-item {
      margin-bottom: 1px;
    }
    x-organizer-item:last-of-type {
      margin-bottom: 0;
    }
    input:hover {
      background: rgba(0, 0, 0, 0.25);
    }
    input:focus {
      background: rgba(0, 0, 0, 0.25);
    }
    input::-webkit-input-placeholder {
      opacity: 0.5;
      color: white;
      font-style: italic;
    }
    x-course-type-filter {
      padding-left: 16px;
    }
  </style>

  <template>
    <section>
      <x-organizer-item
        text="Kurs&uuml;bersicht"
        on-tap="_handleListMode"
        selected="[[!filter.semester.enabled]]">
        <iron-icon
          icon="reorder">
        </iron-icon>
      </x-organizer-item>
      <x-organizer-item
        text="Semesteransicht"
        on-tap="_handleSemesterMode"
        selected="[[filter.semester.enabled]]">
        <iron-icon
          icon="editor:insert-chart">
        </iron-icon>
      </x-organizer-item>
    </section>
    <section>
      <input value="{{filter.query::input}}" placeholder="Suchtext"/>
    </section>
    <section>
      <h1>Kurstypen</h1>
      <x-course-type-filter
        items="[[_types]]"
        selected="{{filter.types.allowed}}">
      </x-course-type-filter>
    </section>
    <section>
      <h1>Bewertungen</h1>
      <x-grade-filter
        selected="{{filter.grades.allowed}}">
      </x-grade-filter>
    </section>
    <section>
      <h1>Kategorien</h1>
      <x-tag-filter
        items="[[_tags]]"
        required="{{filter.tags.required}}"
        forbidden="{{filter.tags.forbidden}}">
      </x-tag-filter>
    </section>
  </template>

  <script>
    Polymer({
      is: "x-organizer",

      properties: {

        courses: {
          type: Array,
          value: []
        },

        filter: {
          type: Object,
          value: new Filter(),
          notify: true
        },

        _types: {
          type: Array,
          computed: "_computeTypes(courses.*)"
        },

        _tags: {
          type: Array,
          computed: "_computeTags(courses.*)"
        }
      },

      _computeTypes: function (courseChange) {
        var courses = courseChange.base;
        if (!courses) return [];
        var types = [];
        courses.forEach(function (course) {
          if (types.indexOf(course.type) < 0) {
            types.push(course.type);
          }
        });
        return types;
      },

      _computeTags: function (courseChange) {
        var courses = courseChange.base;
        if (!courses) return [];
        var tags = [];
        courses.forEach(function (course) {
          course.tags.forEach(function (tag) {
            if (tags.indexOf(tag) < 0) {
              tags.push(tag);
            }
          });
        });
        return tags;
      },

      _handleListMode: function () {
        this.set("filter.semester.enabled", false);
      },

      _handleSemesterMode: function () {
        this.set("filter.semester.enabled", true);
      }
    });
  </script>
</dom-module>
